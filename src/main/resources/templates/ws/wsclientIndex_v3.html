<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head id="Head1">
    <title></title>
    <link rel="stylesheet" type="text/css" href="/js/easyui-1.9.11/css/default.css" />
    <link rel="stylesheet" type="text/css" href="/js/easyui-1.9.11/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="/js/easyui-1.9.11/themes/icon.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/js/plugins/layui/css/layui.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/js/fontAwesome/css/font-awesome.css}">
    <script type="text/javascript" src="/js/easyui-1.9.11/jquery.min.js"></script>
    <script type="text/javascript" src="/js/easyui-1.9.11/jquery.easyui.min.js"></script>
    <script type="text/javascript" src='/js/easyui-1.9.11/indexFramework.js'> </script>
    <script type="text/javascript" th:src="@{/js/jquery/rootPath.js}"></script>
    <script type="text/javascript" th:src="@{/js/common/common.js}"></script>
    <script type="text/javascript" th:src="@{/js/layer/layer.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery/jquery.i18n.properties.js}"></script>
    <script type="text/javascript" th:src="@{/js/plugins/layui/layui.all.js}"></script>
    <th:block th:include="common :: sessionInfo"></th:block>

    <style type="text/css">
        #musicIframeDiv {
            position: fixed;
            width: 168px;
            height: 118px;
            left: 1px;
            bottom: 150px;
            z-index: 99;
            background: black;
            color: rgb(255%, 255%, 255%);
            display: none;
        }

        #musicIframeHeader {
            background: #ddd;
            cursor: move;
            font-size: 10px;
        }

        #recentNewsDiv {
            width: 100%;
            height: 3.5%;
            background-color: #bfffea;
        }

        #weatherDiv label {
            font-size: 25px;
        }

        #headerTitleDiv label {
            font-size: 25px;
        }
    </style>
</head>

<body class="easyui-layout" style="overflow-y: hidden"  scroll="no">
    <!--网页北部区域：头像、时间等信息-->
    <div region="north" split="true" border="false" style="overflow: hidden; height: 62px;
            background: url(/js/easyui/images/layout-browser-hd-bg.gif) #7f99be repeat-x center 50%;
            line-height: 20px;color: #fff; font-family: Verdana, 微软雅黑,黑体">
        <div style="width:180px;height:100%;float:left;">
            <div style="width:62px;height:calc(100% - 2px);float: left;padding:1px;">
                <img th:src="${session.sessionInfo.selfImg}" width="60" height="60">
            </div>
            <div style="width: 50%;height:100%;float: left;margin-left: 5px;">
                <div style="width:100%;height:50%;padding-top: 5px;">
                    <span th:text="${session.sessionInfo.user}" style="font-size: 25px;"></span>
                </div>
                <div style="width:100%;height:50%;padding-top: 8px;">
                    <span class="icon icon-admin" th:title="#{span.onlinecount.tips}"></span><label
                        id="onlineNum">0</label>&nbsp;&nbsp;
                    <span class="icon icon-star" th:title="#{span.coinnum.tips}"></span><label
                        id="coinNum">0</label>
                </div>
            </div>
        </div>

        <div style="width:60%;height:100%;float:left;text-align: center;">
            <!--天气-->
            <div id="weatherDiv" style="height:100%;padding-top:13px;display: block;">
                <label id="weatherInfo" style="color:white;"></label>&nbsp;&nbsp;
                <label id="lastUpdateTime" style="color:white;"></label>&nbsp;&nbsp;
                <label id="location" style="color:white;"></label>
            </div>

            <div id="headerTitleDiv" style="height:100%;font-size:20px;padding-top:13px;display: none;">
                <label id="titleLabel" style="color:white;">websocket客户端</label>
            </div>
        </div>
        <div style="width:auto;height:100%;float:right;text-align:right;padding-right:2px;">
            <div style="height:45%;padding: 5px 5px 0 0;">
                <span id="curTimeSpan" style="font-size:21px;">0000-00-00 00:00:00</span>
            </div>
            <div style="height:50%;padding-top: 5px;">
                    <span class="head">
                        <a href="#" id="playMusicBtn">
                            <span class="icon icon-music2"></span>音乐播放&nbsp;&nbsp;
                        </a>
                        <a href="#" id="signBtn">
                            <span class="icon icon-calendar"></span>每日签到&nbsp;&nbsp;
                        </a>
                        <a href="#" id="qrcodeBtn">
                            <span class="icon icon-telephone"></span>手机登录&nbsp;&nbsp;
                        </a>
                        <a href="#" id="settingBtn">
                            <span class="icon icon-setting"></span>设置&nbsp;&nbsp;
                        </a>
                        <a href="#" id="modifyPasswordBtn">
                            <span class="icon icon-key"></span>修改密码&nbsp;&nbsp;
                        </a>
                        <a href="#" id="loginOutBtn">
                            <span class="icon icon-door-open"></span>安全退出&nbsp;
                        </a>
                    </span>
            </div>
        </div>
    </div>
    
    <!--网页南部区域：网页底部，版权等信息-->
    <div region="south" split="true" style="height: 55px; background: #D2E0F2;">
        <div class="footer" style="height:100%;">
            <div style="height:50%;">
                <div style="width:30%;float:left;text-align:left;">
                    <span>COPYRIGHT 2019 – 2030 版权归作者所有，侵权必究 1.0-Snapshot</span>
                </div>

                <div style="width:30%;float:right;text-align:right;">
                    <a href="#" id="sessionInfoBtn">
                        <span class="icon icon-info"></span>会话信息&nbsp;
                    </a>
                    <a href="#" id="contactBtn">
                        <span class="icon icon-phone"></span>联系作者&nbsp;
                    </a>&nbsp;
                    <a href="#" id="donateBtn">
                        <span class="icon icon-money"></span>捐赠&nbsp;
                    </a>&nbsp;
                    <a href="#" id="feedbackBtn">
                        <span class="icon icon-bugs"></span>反馈建议&nbsp;
                    </a>&nbsp;
                    <a href="#" id="aboutUsBtn">
                        <span class="icon icon-house"></span>关于我们&nbsp;
                    </a>
                </div>
            </div>

            <div style="height:50%;text-align:right;">
                <span>已连上服务器.</span>
            </div>
        </div>
    </div>
    
    <!--网页西部区域：菜单导航-->
    <div region="west" split="true" title="导航菜单" style="width:180px;" id="west">
        <div class="easyui-accordion" fit="true" border="false">
            <!--  导航内容 -->
        </div>
    </div>
    
    <!--网页中间区域：内容部分-->
    <div id="mainPanle" region="center" style="background: #eee; overflow-y:hidden">
        <div region="north" split="true" title="滚动消息" id="recentNewsDiv" style="height:20px;background-color: #E0ECFF;border-bottom: 1px solid #8DB2E3;">
            <marquee direction="left" scrolldelay="10" scrollamount="7" onMouseOver="this.stop()" onMouseOut="this.start()">
                <span id="adsSpan">
                </span>
            </marquee>
        </div>
        <div region="south" split="true" title="内容部分" id="centerDiv" style="height:100%;width:100%;">
            <div id="tabs" class="easyui-tabs"  fit="true" border="false" style="height:100%;width:100%;">
                <div title="首页" data-options="iconCls:'icon icon-house',closable:false" style="padding:20px;overflow:hidden;" id="home">
                    <h1>Welcome to jQuery UI!</h1>

                </div>
            </div>
        </div>
    </div>
    
    <!--修改密码窗口 默认不显示-->
    <div id="modifyPasswordDiv" class="easyui-window" title="修改密码" collapsible="false" minimizable="false"
         maximizable="false" icon="icon-save"  style="width: 300px; height: 150px; padding: 5px;background: #fafafa;">
        <div class="easyui-layout" fit="true">
            <div region="center" border="false" style="padding: 10px; background: #fff; border: 1px solid #ccc;">
                <table cellpadding=3 style="border-collapse:separate; border-spacing:10px;">
                    <tr>
                        <td>用户名：</td>
                        <td><input name="user" type="text" readonly th:value="${session.sessionInfo.user}" class="txt01" /></td>
                    </tr>
                    <tr>
                        <td>旧密码：</td>
                        <td><input name="oldPass" type="password" class="txt01" /></td>
                    </tr>
                    <tr>
                        <td>新密码：</td>
                        <td><input name="newPass" type="password" class="txt01" /></td>
                    </tr>
                    <tr>
                        <td>确认密码：</td>
                        <td><input name="confirmPass" type="password" class="txt01" /></td>
                    </tr>
                </table>
            </div>
            <div region="south" border="false" style="text-align: right; height: 30px; line-height: 30px;">
                <a class="easyui-linkbutton" icon="icon-ok" href="javascript:void(0)" onclick="modifyPassword()">确定</a>
                <a class="easyui-linkbutton" icon="icon-cancel" href="javascript:void(0)" onclick="cancel()">取消</a>
            </div>
        </div>
    </div>

    <!--tab框区域右键菜单栏 默认不显示-->
    <div id="mm" class="easyui-menu" style="width:150px;">
        <div id="mm-tabclose">关闭</div>
        <div id="mm-tabcloseall">全部关闭</div>
        <div id="mm-tabcloseother">除此之外全部关闭</div>
        <div class="menu-sep"></div>
        <div id="mm-tabcloseright">当前页右侧全部关闭</div>
        <div id="mm-tabcloseleft">当前页左侧全部关闭</div>
        <div class="menu-sep"></div>
        <div id="mm-exit">退出</div>
    </div>

    <!--右上角 二维码 默认不显示-->
    <div id="qrDiv" style="display:none;position: fixed;right: 5px;top: 90px;width: 180px;height: 180px;">
        <img id="qrcodeImg" style="width: 160px;height: 160px;">
    </div>

    <!--左下角 迷你音乐播放器 默认不显示-->
    <div id='musicIframeDiv'>
        <div id='musicIframeHeader'>
            <span style='display:inline-block;width:67%;color: black;font-weight: bold;'>&nbsp;&nbsp;按住我拖动&nbsp;&nbsp;</span>
            <button id='resetMusicIframeDivPosBtn' style='display:inline-block;width:30%;color:black;'>复位</button>
        </div>
        <iframe id="musicIframePage" width="100%" height="100%" src="../file/musicPlayerSimple.page"></iframe>
    </div>
</body>

<script type="text/javascript">
    // 左侧导航菜单
    var _menus = {};
    if (sessionUsertype == '0') {
        // 管理员菜单
        _menus = {
            "menus": [
                {
                    "menuid": "1", "icon": "icon-menu-folder-open", "menuname": "系统管理",
                    "menus": [
                        {"menuname": "用户管理", "icon": "icon-users", "url": "/zhddkk/wsUsers/wsUsersForAdmin?user="+sessionUser},
                        {"menuname": "音乐播放", "icon": "icon-music", "url": "../file/musicPlayer.page?user="+sessionUser},
                        {"menuname": "聊天监控", "icon": "icon-video", "url": "/ws/wsserverChartMonitor.page?user="+sessionUser},
                        {"menuname": "朋友圈", "icon": "icon-earth", "url": "/ws/wsclientCircle.page?user="+sessionUser},
                        {"menuname": "聊天记录", "icon": "icon-file", "url": "/zhddkk/wsChatlog?user="+sessionUser},
                        {"menuname": "操作记录", "icon": "icon-file", "url": "/zhddkk/wsOperationLog?user="+sessionUser},
                        {"menuname": "广告发布", "icon": "icon-edit", "url": "/zhddkk/wsAds?user="+sessionUser},
                        {"menuname": "反馈建议", "icon": "icon-feedback", "url": "/zhddkk/wsFeedback/adminFeedback?user="+sessionUser},
                        {"menuname": "领导驾驶舱", "icon": "icon-chart-bar", "url": "/ws/wsserverChart.page?user="+sessionUser},
                        {"menuname": "定时任务", "icon": "icon-clock", "url": "/zhddkk/wsScheduledCron?user="+sessionUser},
                        {"menuname": "生成代码", "icon": "icon-java", "url": "/common/generator?user="+sessionUser}
                    ]
                }
                , {
                    "menuid": "2", "icon": "icon-menu-folder-close", "menuname": "通用配置",
                    "menus": [
                        {"menuname": "敏感词配置", "icon": "icon-nav", "url": "/zhddkk/wsCommon/mgc?user="+sessionUser},
                        {"menuname": "脏话配置", "icon": "icon-nav", "url": "/zhddkk/wsCommon/zh?user="+sessionUser},
                        {"menuname": "常用语配置", "icon": "icon-nav", "url": "/zhddkk/wsCommon/cyy?user="+sessionUser},
                        {"menuname": "注册问题配置", "icon": "icon-nav", "url": "/zhddkk/wsCommon/zcwt?user="+sessionUser}
                    ]
                }
                , {
                    "menuid": "3", "icon": "icon-menu-folder-close", "menuname": "娱乐管理",
                    "menus": [
                        {"menuname": "游戏娱乐", "icon": "icon-football", "url": "../game/gameIndex.page?user="+sessionUser},
                        {"menuname": "H5游戏", "icon": "icon-game-hander", "url": "../canvas/canvasIndex.page?user="+sessionUser}
                    ]
                }
            ]
        };
    } else {
        // 普通用户菜单
        _menus = {
            "menus": [
                {
                    "menuid": "1", "icon": "icon-menu-folder-open", "menuname": "系统管理",
                    "menus": [
                        {"menuname": "实时聊天", "icon": "icon-role", "url": "/ws/wsclientChat.page?user="+sessionUser},
                        {"menuname": "音乐播放", "icon": "icon-music", "url": "/file/musicPlayer.page?user="+sessionUser},
                        {"menuname": "添加朋友", "icon": "icon-search-plus", "url": "/zhddkk/wsUsers/wsUsers?user="+sessionUser},
                        {"menuname": "我的朋友", "icon": "icon-role", "url": "/zhddkk/wsFriends?user="+sessionUser},
                        {"menuname": "我的申请", "icon": "icon-upload", "url": "/zhddkk/wsFriendsApply/myApply?user="+sessionUser},
                        {"menuname": "好友申请", "icon": "icon-download", "url": "/zhddkk/wsFriendsApply/friendApply?user="+sessionUser},
                        {"menuname": "朋友圈", "icon": "icon-earth", "url": "/ws/wsclientCircle.page?user="+sessionUser},
                        {"menuname": "反馈建议", "icon": "icon-feedback", "url": "/zhddkk/wsFeedback/myFeedback?user="+sessionUser},
                        {"menuname": "智能助手", "icon": "icon-user5", "url": "/ws/intelAssistant.page?user="+sessionUser},
                        {"menuname": "网易新闻", "icon": "icon-newspaper", "url": "/ws/wangyiNews.page?user="+sessionUser}
                    ]
                }
                , {
                    "menuid": "3", "icon": "icon-menu-folder-close", "menuname": "娱乐管理",
                    "menus": [
                        {"menuname": "游戏娱乐", "icon": "icon-football", "url": "../game/gameIndex.page?user="+sessionUser},
                        {"menuname": "H5游戏", "icon": "icon-game-hander", "url": "../canvas/canvasIndex.page?user="+sessionUser}
                    ]
                }
            ]
        };
    }

    $(function() {
        console.log("主页获取session数据:" + sessionUser);
        // 修改地址栏地址,不显示多余的参数或者页面信息
        history.replaceState(null, null, "/");

        // 修改密码对话框
        openModifyPasswordDialog();

        // 设置网页标题
        setPageTitle();
        function setPageTitle() {
            let title = "";
            if (sessionUsertype == "0") {
                title = "page.serverindex.title";
            } else {
                title = "page.clientindex.title";
            }
            $("title").text($.ws.i18n(title));
        }

        //定时获取天气
        grapWeatherInfo();
        function grapWeatherInfo() {
            $.ajax({
                type: 'GET',
                url: rootUrl + 'index/grapWetherInfo',
                async: false,
                success: function (result) {
                    if (result.code == 1) {
                        $("#weatherInfo").text(result.data.remark);
                        $("#lastUpdateTime").text(result.data.lastUpdateTime);
                        $("#location").text(result.data.location);
                    }
                }
            });
        }

        //定时切换header标题
        var headerTitle = $.ws.i18n("web.title");
        setInterval(function () {
            var titleStatus = $("#headerTitleDiv").css("display");
            if (titleStatus == "none") {
                $("#titleLabel").text(headerTitle);
                $("#headerTitleDiv").css("display", "block");
                $("#weatherDiv").css("display", "none");
            } else {
                $("#headerTitleDiv").css("display", "none");
                $("#weatherDiv").css("display", "block");
            }
        }, 8000);

        //定时更新时间
        setInterval(function () {
            var curTime = getCurrentTime();
            $("#curTimeSpan").text(curTime);
        }, 1000);

        // 音乐播放
        $("#playMusicBtn").click(function (){
            var displayStatus = $("#musicIframeDiv").css("display");
            if (displayStatus == "none") {
                $("#musicIframeDiv").css("display", "block");
            } else {
                $("#musicIframeDiv").css("display", "none");
            }
        });

        // 每日签到
        $("#signBtn").click(function() {
            $.ajax({
                type: 'POST',
                url: '/zhddkk/wsSign/sign',
                data: {"user": sessionUser},
                async: false,
                success: function (result) {
                    layer.msg(result.msg);
                }
            });
        });

        // 手机登录
        $("#qrcodeBtn").click(function() {
            var imgSrc = $("#qrcodeImg").attr("src");
            if (imgSrc == "" || imgSrc == undefined) {
                $.ajax({
                    type: 'POST',
                    url: '/showQRCode.do',
                    //dataType: 'json',
                    async: false,
                    success: function (result) {
                        $("#qrDiv").css("display", "block");
                        $("#qrcodeImg").css("display", "block");
                        $("#qrcodeImg").attr("src", result);
                    }
                });
            } else {
                $("#qrcodeImg").attr("src", "");
                $("#qrDiv").css("display", "none");
                $("#qrcodeImg").css("display", "none");
            }
        });

        // 设置
        $("#settingBtn").click(function() {
            layer.open({
                type: 2,
                title: '设置个人信息',
                shadeClose: true,
                shade: 0.2,
                area: ['540px', '580px'],
                anim: 1,
                content: '/zhddkk/wsUsers/setPersonalInfo.page?user=' + sessionUser
            });
        });

        // 修改密码
        $("#modifyPasswordBtn").click(function (){
            $('#modifyPasswordDiv').window('open');
        })

        // 退出
        $("#loginOutBtn").click(function() {
            $.ajax({
                type: 'POST',
                url: 'ws/logout.do',
                data: {"user": sessionUser},
                async: false,
                success: function (result) {
                    top.location.href = rootUrl;
                }
            });
        });

        // 会话信息
        $("#sessionInfoBtn").click(function() {
            layer.open({
                type: 2,
                title: '会话信息',
                maxmin: false,
                shadeClose: true,//点击遮罩关闭层
                area: ['630px', '410px'],
                anim: 1,
                content: '/sessionInfo.page'
            });
        });

        // 联系作者
        $("#contactBtn").click(function() {
            layer.open({
                type: 2,
                title: '联系作者',
                maxmin: false,
                shadeClose: true,//点击遮罩关闭层
                area: ['530px', '300px'],
                anim: 1,
                content: 'index/contactAuthor.page'
            });
        });

        //捐赠作者
        $("#donateBtn").click(function() {
            layer.open({
                type: 2,
                title: '捐赠作者',
                maxmin: false,
                shadeClose: true,//点击遮罩关闭层
                area: ['530px', '300px'],
                anim: 1,
                content: 'index/donate.page'
            });
        });

        //提出疑问
        $("#feedbackBtn").click(function() {
            parent.layer.open({
                type: 2,
                title: '提出疑问',
                maxmin: false,
                shadeClose: true,//点击遮罩关闭层
                area: ['530px', '300px'],
                anim: 1,
                content: 'index/feedbackUs.page'
            });
        });

        //关于我们
        $("#aboutUsBtn").click(function() {
            parent.layer.open({
                type: 2,
                title: '关于我们',
                maxmin: false,
                shadeClose: true,//点击遮罩关闭层
                area: ['530px', '300px'],
                anim: 1,
                content: 'index/aboutUs.page'
            });
        });

        // 简易音乐播放器复位
        $("#resetMusicIframeDivPosBtn").click(adjustMusicWindowPosition);
        function adjustMusicWindowPosition() {
            $("#musicIframeDiv").css("bottom", "150px");
            $("#musicIframeDiv").css("left", "1px");
        }
        //音乐播放器可拖动代码
        $.ws.dragPanelMove("#musicIframeHeader", "#musicIframeDiv");

        //获取在线人数和积分数量
        getOnlineInfo();
        function getOnlineInfo() {
            $.ajax({
                type: 'GET',
                url: 'ws/getOnlineInfo.json',
                data: {"user": sessionUser},
                //dataType: 'json',
                success: function (result) {
                    if (result.code != 1) {
                        return;
                    }
                    var jsonObj = result.data;
                    var currentUserOnlineInfo = jsonObj.currentOnlineUserInfo;
                    var coinNum = currentUserOnlineInfo.coinNum;
                    var onlineNum = jsonObj.onlineUserList.length;
                    var headImage = currentUserOnlineInfo.headImage;

                    $("#coinNum").text(coinNum);
                    $("#onlineNum").text(onlineNum);
                    if (headImage == null || headImage == "") {
                        $("#myImg").attr("src", rootUrl + "../img/" + $.ws.errorImageName);
                    } else {
                        $("#myImg").attr("src", headImage);
                    }
                }
            });
        }

        //获取最新广告
        queryRecentAdsList();
        function queryRecentAdsList() {
            $.ajax({
                type: 'GET',
                url: '/zhddkk/wsAds/queryRecentAdsList?count=4',
                async: false,
                success: function (result) {
                    if (result.code == 1) {
                        var totalAds = "";
                        var data = result.data;
                        if (data.length == 0) {
                            totalAds = "<span style='font-weight: bold;font-size:14px;color:red;'>暂无消息</span>";
                        } else {
                            $.each(data, function (i, val) {
                                totalAds += "<span style='font-size:14px;font-weight: bold'>" + val.title + "</span>" + "<span style='font-size:9px;margin-left:5px;margin-right: 200px;'>" + val.createTime + "<a style='color:blue;font-weight: bold;' onclick='showAdsDetail(" + val.id + ")'>【查看详情】</a>" + "</span>";
                            });
                        }
                        $("#adsSpan").html(totalAds);
                    }
                }
            });
        }
    });

    // 修改密码对话框
    function openModifyPasswordDialog() {
        $('#modifyPasswordDiv').window({
            title: '修改密码',
            width: 300,
            modal: true,
            shadow: true,
            closed: true,
            height: 260,
            resizable:false
        });
    }

    // 取消修改密码
    function cancel() {
        $('#modifyPasswordDiv').window('close');
    }

    // 修改密码
    function modifyPassword() {
        $.ajax({
            type: 'POST',
            url: '/zhddkk/wsUsers/updatePassword.do',
            data: {"user": sessionUser,
                    "oldPass": $("input[name='oldPass']").val(),
                    "newPass": $("input[name='newPass']").val(),
                    "confirmPass": $("input[name='confirmPass']").val(),
            },
            //dataType: 'json',
            success: function (result) {
                if (result.code == 1) {
                    layer.msg("密码修改成功");
                } else {
                    layer.msg(result.data);
                }
                setTimeout(cancel, 2500);
            }
        });
    }

    /**
     * 查看广告详情页
     * @param adId
     */
    function showAdsDetail(adId) {
        window.open("./zhddkk/wsAds/adsDetail.page?id=" + adId);
    }
</script>
</html>